function retina_is() {
	let media = '(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)';

	if (window.devicePixelRatio > 1) {
		return true;
	}

	if (window.matchMedia && window.matchMedia(media).matches) {
		return true;
	}

	return false;
}

function retina_replace(img, path) {
	img.attr('src', path);
}

function retina_load(img, path) {
	let  xhr = new XMLHttpRequest();

	xhr.open('HEAD', path);
	xhr.onreadystatechange = function() {
		if (xhr.readyState !== 4) {
			return false;
		}

		if (xhr.status >= 200 && xhr.status <= 399) {
			retina_replace(img, path);
		} else {
			return false;
		}
	};
	xhr.send();
}

function retina_suffix(match) {
	return '@2x' + match;
}

function retina_start(e) {
	if (retina_is() == true) {
		if (!e) {
			e = 'img';
		}

		$(e).each(function() {
			let regex = /\.\w+[0-9+\?]{0,4}$/,
				img = $(this),
				path = img.attr('src');

			if (!path.match(/\.svg/i) && !path.match(/@2x/i) && !path.match(/img\.youtube\.com/i) && !path.match(/vimeocdn\.com/i)) {
				console.log(path);
				let path_2x = path.replace(regex, retina_suffix);;

				retina_load(img, path_2x);
			}
		});
	}
}